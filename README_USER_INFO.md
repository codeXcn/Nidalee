# 用户信息获取功能 - 完整实现

## 🎉 功能概述

已成功实现了根据 League Client Protocol (LCP) token 自动获取并展示用户信息的完整功能。

## ✨ 主要特性

### 🔄 自动获取用户信息
- **自动连接时获取**: 连接到游戏客户端后自动获取召唤师信息
- **包含排位数据**: 自动获取单双排位信息（段位、等级、胜点）
- **智能重试**: 连接失败时自动重试，成功后立即获取用户信息

### 🎨 美观的UI展示
- **渐变卡片设计**: 现代化的渐变背景和卡片布局
- **头像展示**: 自动获取并显示召唤师头像
- **等级徽章**: 突出显示召唤师等级
- **排位信息**: 美观的排位展示，包含段位颜色区分
- **响应式设计**: 支持深色/浅色主题

### 📝 详细的日志输出
- **连接过程日志**: 详细记录连接步骤和状态
- **API调用日志**: 记录每个LCP API的调用过程
- **用户信息日志**: 完整展示获取到的用户数据
- **错误处理日志**: 详细的错误信息和警告

## 🚀 使用方法

### 自动使用（推荐）
1. 启动 Nidalee 应用
2. 启动英雄联盟客户端
3. 应用会自动连接并获取用户信息
4. 在仪表板中查看漂亮的用户信息卡片

### 手动刷新
在用户信息卡片中点击"刷新信息"按钮可以手动获取最新数据。

## 📊 控制台日志示例

当功能正常工作时，你会在控制台看到类似这样的日志：

```
🚀 自动连接成功: LeagueClient (12345) 端口: 54321
🎮 自动连接成功，开始获取用户信息...
📡 开始获取召唤师信息...
🔐 使用Token: AbCdEfGh...
🌐 连接端口: 54321
📞 调用 /lol-summoner/v1/current-summoner API...
👤 召唤师基础信息: {
  id: 12345678,
  name: "你的召唤师名",
  level: 123,
  profileIconId: 4567,
  puuid: "AbCdEfGh..."
}
🏆 开始获取排位信息...
📊 排位数据原始信息: {...}
🥇 单双排位信息: {
  tier: "GOLD",
  division: "II",
  leaguePoints: 75,
  queueType: "RANKED_SOLO_5x5"
}
🎉 用户信息获取成功!
👨‍💼 完整用户信息: {
  召唤师名称: "你的召唤师名",
  召唤师ID: "12345678",
  等级: 123,
  头像ID: 4567,
  PUUID: "AbCdEfGh...",
  排位信息: {
    tier: "GOLD",
    division: "II",
    leaguePoints: 75,
    queueType: "RANKED_SOLO_5x5"
  }
}
✅ 自动获取用户信息完成
```

## 🎯 实现流程

### 连接流程
1. **启动自动连接** → 检测游戏客户端
2. **解析 Lockfile** → 获取连接信息 (token, port)
3. **建立连接** → 初始化 LCP 客户端
4. **获取用户信息** → 自动调用 `getUserInfo()`

### 数据获取流程
1. **创建LCP客户端** → 使用 token 和 port
2. **调用用户API** → `/lol-summoner/v1/current-summoner`
3. **获取排位数据** → `/lol-ranked/v1/ranked-stats/{puuid}`
4. **数据处理** → 转换为统一格式
5. **更新UI** → 实时显示在用户信息卡片中

## 🛠️ 技术实现

### 后端 (Tauri + Rust)
- `find_lol_lockfile()`: 查找并解析 lockfile
- `init_game_connection()`: 初始化游戏连接
- 进程监控和自动重连机制

### 前端 (Vue 3 + TypeScript)
- `useGameStore.ts`: 状态管理和API调用
- `UserInfoCard.vue`: 用户信息展示组件
- `DashboardView.vue`: 集成到仪表板页面

### 数据流
```
Lockfile → Token → LCP Client → API调用 → 数据处理 → UI展示
```

## 🔍 故障排除

### 常见问题

**Q: 用户信息卡片显示"暂无召唤师信息"**
- A: 确保英雄联盟客户端已启动并完成登录

**Q: 控制台显示连接失败**
- A: 检查游戏客户端是否正在运行，尝试重启客户端

**Q: 获取排位信息失败**
- A: 这是正常现象，未定级玩家或API暂时不可用时会发生

**Q: 头像不显示**
- A: 网络问题或CDN访问受限，会自动使用默认头像

### 调试建议
1. 打开浏览器开发者工具查看控制台日志
2. 检查网络连接和防火墙设置
3. 确认英雄联盟客户端版本兼容性

## 🎨 UI预览

用户信息卡片包含：
- **左侧**: 召唤师头像 + 等级徽章
- **右侧**: 召唤师名称、ID、排位信息
- **底部**: 刷新按钮（带加载动画）
- **样式**: 渐变背景、毛玻璃效果、响应式设计

排位信息会根据段位显示不同颜色：
- 🟤 黑铁 | 🟫 黄铜 | ⚪ 白银 | 🟡 黄金
- 🔵 铂金 | 💎 钻石 | 🟣 大师 | 🔥 宗师 | 👑 王者

## ✅ 完成状态

- [x] LCP Token 获取和使用
- [x] 召唤师基本信息获取
- [x] 排位信息获取和展示
- [x] 自动连接后获取信息
- [x] 美观的用户信息卡片
- [x] 详细的控制台日志
- [x] 错误处理和重试机制
- [x] 响应式设计和深色模式
- [x] 集成到仪表板界面

## 🎊 总结

此功能完全实现了你的需求：
1. ✅ **自动连接后调用获取用户信息**
2. ✅ **打出详细的log日志**
3. ✅ **漂亮的UI展示用户信息**
4. ✅ **正确的逻辑流程**

现在只需要启动英雄联盟客户端，Nidalee 就会自动连接并在仪表板中展示你的召唤师信息了！🎮✨
